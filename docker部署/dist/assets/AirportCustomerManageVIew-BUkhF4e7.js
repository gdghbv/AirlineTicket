import{_ as Q,r as v,x as N,B as W,c as X,d as l,w as o,e as u,E as f,z as Y,o as x,a as h,m as Z,f as i,l as y,G as ee,H as P,h as le,t as k,I as oe,J as te,K as ae}from"./index-DuoLJuUX.js";import{q as se,r as ne,s as re}from"./airport-DZ6oIf4n.js";import"./request-DuNoOhOk.js";const ue={class:"customer-manage"},de={class:"card-header"},ie={class:"search-section"},me={class:"pagination-wrapper"},pe={class:"dialog-footer"},ce={__name:"AirportCustomerManageVIew",setup(ge){const w=v(!1),C=v([]),b=v(!1),V=v(null),r=N({customerId:"",userName:"",phone:""}),s=N({customerId:null,userName:"",email:"",phone:"",milsPoints:0}),n=N({pageNum:1,pageSize:10,totalSize:0}),U={userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}]},d=async()=>{try{w.value=!0;const a={idKeywords:r.customerId||"",nameKeywords:r.userName||"",phoneKeywords:r.phone||"",emailKeywords:"",pageNum:n.pageNum.toString(),pageSize:n.pageSize.toString()};console.log("搜索参数:",a);const e=await se(a);console.log("API响应:",e),C.value=e.pageData||[],n.totalSize=e.totalSize||0,C.value.length===0&&n.pageNum>1&&(n.pageNum=1,d())}catch(a){console.error("获取客户列表失败:",a),f.error("获取客户列表失败: "+(a.message||"未知错误"))}finally{w.value=!1}},B=()=>{console.log("执行搜索，参数:",r),n.pageNum=1,d()},D=()=>{Object.assign(r,{customerId:"",userName:"",phone:""}),n.pageNum=1,console.log("重置搜索参数"),d()},F=a=>{Object.assign(s,{customerId:a.customerId,userName:a.userName||"",email:a.email||"",phone:a.phone||"",milsPoints:a.milsPoints||0}),b.value=!0},K=a=>{ae.confirm(`确定要删除客户 "${a.userName||a.phone}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{M(a.customerId)}).catch(()=>{f.info("已取消删除")})},M=async a=>{try{await re(a),f.success("删除成功"),d()}catch(e){console.error("删除客户失败:",e),f.error("删除失败")}},A=()=>{V.value.validate(async a=>{if(a)try{const e={customerId:s.customerId,userName:s.userName,email:s.email,phone:s.phone,milsPoints:s.milsPoints,password:"81dc9bdb52d04dc20036dbd8313ed055"};console.log("提交数据:",e),await ne(e),f.success("修改成功"),b.value=!1,d()}catch(e){console.error("修改失败:",e),f.error("修改失败: "+(e.message||"未知错误"))}})},I=()=>{b.value=!1,V.value&&V.value.clearValidate()},E=a=>{n.pageSize=a,n.pageNum=1,d()},j=a=>{n.pageNum=a,d()},q=({column:a,prop:e,order:p})=>{console.log("排序:",{column:a,prop:e,order:p})},T=()=>{console.log("刷新数据"),d()};return W(()=>{console.log("组件挂载，获取客户列表"),d()}),(a,e)=>{const p=u("el-icon"),c=u("el-button"),_=u("el-input"),m=u("el-form-item"),z=u("el-form"),g=u("el-table-column"),S=u("el-tag"),$=u("el-table"),L=u("el-pagination"),O=u("el-card"),R=u("el-input-number"),G=u("el-dialog"),H=Y("loading");return x(),X("div",ue,[l(O,{class:"customer-card",shadow:"never"},{header:o(()=>[h("div",de,[e[11]||(e[11]=h("span",null,"客户管理",-1)),l(c,{type:"primary",onClick:T},{default:o(()=>[l(p,null,{default:o(()=>[l(y(P))]),_:1}),e[10]||(e[10]=i(" 刷新 "))]),_:1,__:[10]})])]),default:o(()=>[h("div",ie,[l(z,{model:r,inline:""},{default:o(()=>[l(m,{label:"客户ID"},{default:o(()=>[l(_,{modelValue:r.customerId,"onUpdate:modelValue":e[0]||(e[0]=t=>r.customerId=t),placeholder:"请输入客户ID",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"用户名"},{default:o(()=>[l(_,{modelValue:r.userName,"onUpdate:modelValue":e[1]||(e[1]=t=>r.userName=t),placeholder:"请输入用户名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号"},{default:o(()=>[l(_,{modelValue:r.phone,"onUpdate:modelValue":e[2]||(e[2]=t=>r.phone=t),placeholder:"请输入手机号",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(m,null,{default:o(()=>[l(c,{type:"primary",onClick:B},{default:o(()=>[l(p,null,{default:o(()=>[l(y(ee))]),_:1}),e[12]||(e[12]=i(" 搜索 "))]),_:1,__:[12]}),l(c,{onClick:D},{default:o(()=>[l(p,null,{default:o(()=>[l(y(P))]),_:1}),e[13]||(e[13]=i(" 重置 "))]),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),Z((x(),le($,{data:C.value,stripe:"",style:{width:"100%"},onSortChange:q},{default:o(()=>[l(g,{prop:"customerId",label:"客户ID",width:"80",sortable:""}),l(g,{prop:"userName",label:"用户名",width:"120"}),l(g,{prop:"phone",label:"手机号",width:"130"}),l(g,{prop:"email",label:"邮箱",width:"200"}),l(g,{prop:"milsPoints",label:"积分",width:"100",sortable:""},{default:o(t=>[l(S,{type:t.row.milsPoints>1e3?"success":"info"},{default:o(()=>[i(k(t.row.milsPoints||0),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"会员状态",width:"100"},{default:o(t=>[l(S,{type:t.row.milsPoints>0?"success":"info"},{default:o(()=>[i(k(t.row.milsPoints>0?"会员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"操作",width:"180",fixed:"right"},{default:o(t=>[l(c,{size:"small",onClick:J=>F(t.row)},{default:o(()=>[l(p,null,{default:o(()=>[l(y(oe))]),_:1}),e[14]||(e[14]=i(" 编辑 "))]),_:2,__:[14]},1032,["onClick"]),l(c,{size:"small",type:"danger",onClick:J=>K(t.row)},{default:o(()=>[l(p,null,{default:o(()=>[l(y(te))]),_:1}),e[15]||(e[15]=i(" 删除 "))]),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,w.value]]),h("div",me,[l(L,{"current-page":n.pageNum,"onUpdate:currentPage":e[3]||(e[3]=t=>n.pageNum=t),"page-size":n.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>n.pageSize=t),"page-sizes":[10,20,50,100],total:n.totalSize,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1}),l(G,{title:"编辑客户信息",modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=t=>b.value=t),width:"500px","before-close":I},{footer:o(()=>[h("span",pe,[l(c,{onClick:I},{default:o(()=>e[16]||(e[16]=[i("取消")])),_:1,__:[16]}),l(c,{type:"primary",onClick:A},{default:o(()=>e[17]||(e[17]=[i("保存")])),_:1,__:[17]})])]),default:o(()=>[l(z,{model:s,rules:U,ref_key:"editFormRef",ref:V,"label-width":"80px"},{default:o(()=>[l(m,{label:"用户名",prop:"userName"},{default:o(()=>[l(_,{modelValue:s.userName,"onUpdate:modelValue":e[5]||(e[5]=t=>s.userName=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(m,{label:"邮箱",prop:"email"},{default:o(()=>[l(_,{modelValue:s.email,"onUpdate:modelValue":e[6]||(e[6]=t=>s.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号",prop:"phone"},{default:o(()=>[l(_,{modelValue:s.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>s.phone=t),placeholder:"请输入手机号",disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"积分"},{default:o(()=>[l(R,{modelValue:s.milsPoints,"onUpdate:modelValue":e[8]||(e[8]=t=>s.milsPoints=t),min:0,max:999999,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},he=Q(ce,[["__scopeId","data-v-d5d7780d"]]);export{he as default};
